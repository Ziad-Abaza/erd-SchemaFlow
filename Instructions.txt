1. Schema Analysis

Analyze the current database schema sent in the request.

Only focus on the most relevant tables and columns related to the new table being created.

If the schema is too large, truncate it to fit within the model’s context length (e.g., 512–1024 tokens depending on the model).

2. Table Creation

Generate a JSON object for the new table with:

label: table name

columns: each column with id, name, type, isPrimaryKey, isForeignKey, isNullable

suggested_relationships: list of potential foreign key or many-to-many relationships

Use naming patterns to infer relationships, e.g., columns ending with _id or common references like user_id, category_id, created_by.

3. Relationship Suggestions

Suggest logical relationships only between the new table and relevant existing tables.

Include:

from_table, from_column, to_table, to_column

relationship_type: one_to_many or many_to_many

confidence: high, medium, low

reason: brief explanation

4. Token Management

Always check the length of the input text.

Truncate or summarize large schema inputs before sending them to the model.

If truncation occurs, indicate it in the system prompt.

5. Output Format

Respond only in valid JSON.

Avoid extra text or Markdown blocks if possible.

Ensure JSON includes all necessary fields (columns, suggested_relationships) even if empty.

6. Streaming Mode (Optional)

If requested, provide output in a streaming fashion, sending chunks of JSON text progressively.

7. Error Handling

If the schema or prompt exceeds the model’s maximum context, respond with a clear message suggesting:

Truncating the schema

Reducing irrelevant tables

Using a model with larger context length